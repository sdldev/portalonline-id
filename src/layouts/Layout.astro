---
import { ClientRouter } from "astro:transitions";
import ChatWidget from "../components/ChatWidget.astro";
import "../styles/global.css";

export interface Props {
    title?: string;
    description?: string;
}

const {
    title = "Portal Online | Berita Terkini & Terpercaya",
    description = "Portal berita online terkini dengan beragam kategori, breaking news, dan konten multimedia. Dapatkan informasi terpercaya dari sumber kredibel.",
} = Astro.props;
---

<!doctype html>
<html lang="id">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content={description} />

        <!-- Force HTTPS for all resources -->
        <meta
            http-equiv="Content-Security-Policy"
            content="upgrade-insecure-requests"
        />

        <!-- Preload navbar logo for FCP/LCP -->
        <link
            rel="preload"
            href="/portalonline-sm.webp"
            as="image"
            type="image/webp"
        />

        <!-- Favicon -->
        <link rel="icon" href="/favicon.ico" sizes="48x48" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
        <link rel="manifest" href="/site.webmanifest" />
        <meta name="theme-color" content="#f59e0b" />

        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;700&display=swap"
            rel="stylesheet"
        />

        <!-- SEO -->
        <meta name="robots" content="index, follow" />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:type" content="website" />
        <meta name="twitter:card" content="summary_large_image" />

        <title>{title}</title>

        <!-- View Transitions -->
        <ClientRouter />
    </head>
    <body>
        <!-- Scanline Transition Overlay -->
        <div class="transition-scanline" id="transition-scanline"></div>

        <!-- Cosmic Background (persistent during transitions) -->
        <div
            class="fixed inset-0 pointer-events-none overflow-hidden"
            style="z-index: -1;"
            transition:persist
        >
            <div
                class="cosmic-glow cosmic-glow-primary animate-pulse-glow"
                style="width: 600px; height: 600px; top: -200px; left: 50%; transform: translateX(-50%);"
            >
            </div>
            <div
                class="cosmic-glow cosmic-glow-accent animate-float-slow"
                style="width: 400px; height: 400px; bottom: 20%; right: -100px;"
            >
            </div>
            <div
                class="cosmic-glow cosmic-glow-primary animate-float-slow"
                style="width: 300px; height: 300px; bottom: 10%; left: -50px; animation-delay: -5s;"
            >
            </div>
        </div>

        <slot />

        <!-- WhatsApp Chat Widget -->
        <ChatWidget />

        <style is:global>
            .fixed {
                position: fixed;
            }
            .inset-0 {
                top: 0;
                right: 0;
                bottom: 0;
                left: 0;
            }
            .pointer-events-none {
                pointer-events: none;
            }
            .overflow-hidden {
                overflow: hidden;
            }

            /* Scanline Transition Overlay */
            .transition-scanline {
                position: fixed;
                left: 0;
                right: 0;
                top: -100%;
                height: 150px;
                z-index: 9999;
                pointer-events: none;
                background: linear-gradient(
                    to bottom,
                    transparent,
                    rgba(245, 158, 11, 0.3),
                    transparent
                );
                backdrop-filter: brightness(1.5);
                -webkit-backdrop-filter: brightness(1.5);
            }

            .transition-scanline.active {
                animation: scanline-sweep 0.8s ease-in-out forwards;
            }

            @keyframes scanline-sweep {
                0% {
                    top: -100%;
                }
                100% {
                    top: 100%;
                }
            }

            /* View Transitions - Custom Animations */
            /* Old page animation (exit) */
            ::view-transition-old(root) {
                animation: page-exit 0.4s cubic-bezier(0.22, 1, 0.36, 1)
                    forwards;
            }

            /* New page animation (enter) */
            ::view-transition-new(root) {
                animation: page-enter 0.5s cubic-bezier(0.22, 1, 0.36, 1)
                    forwards;
            }

            @keyframes page-exit {
                0% {
                    opacity: 1;
                    transform: scale(1);
                    filter: blur(0px);
                }
                100% {
                    opacity: 0;
                    transform: scale(1.05);
                    filter: blur(15px);
                }
            }

            @keyframes page-enter {
                0% {
                    opacity: 0;
                    transform: scale(0.96);
                    filter: blur(15px);
                }
                100% {
                    opacity: 1;
                    transform: scale(1);
                    filter: blur(0px);
                }
            }

            /* Ensure smooth transition group for content */
            main {
                view-transition-name: main-content;
            }

            ::view-transition-old(main-content) {
                animation: page-exit 0.4s cubic-bezier(0.22, 1, 0.36, 1)
                    forwards;
            }

            ::view-transition-new(main-content) {
                animation: page-enter 0.5s cubic-bezier(0.22, 1, 0.36, 1)
                    forwards;
            }
        </style>

        <script>
            // Trigger scanline effect on page navigation
            document.addEventListener("astro:before-swap", () => {
                const scanline = document.getElementById("transition-scanline");
                if (scanline) {
                    scanline.classList.remove("active");
                    // Force reflow
                    void scanline.offsetWidth;
                    scanline.classList.add("active");
                }
            });

            // Scroll to top on navigation
            document.addEventListener("astro:after-swap", () => {
                window.scrollTo({ top: 0, behavior: "instant" });
            });

            // Clean up scanline after animation
            document.addEventListener("astro:page-load", () => {
                const scanline = document.getElementById("transition-scanline");
                if (scanline) {
                    setTimeout(() => {
                        scanline.classList.remove("active");
                    }, 800);
                }
            });
        </script>
    </body>
</html>
