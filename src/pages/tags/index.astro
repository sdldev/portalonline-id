---
import { getCollection } from "../../utils/collections";
import Layout from "../../layouts/Layout.astro";
import Navbar from "../../components/Navbar.astro";
import Footer from "../../components/Footer.astro";

const allContent = [
    ...(await getCollection("tutorial")),
    ...(await getCollection("article")),
    ...(await getCollection("tips")),
    ...(await getCollection("update")),
];

const tagCounts = allContent
    .flatMap((item) => item.data.tags ?? [])
    .reduce(
        (acc, tag) => {
            acc[tag] = (acc[tag] || 0) + 1;
            return acc;
        },
        {} as Record<string, number>,
    );

const sortedTags = Object.entries(tagCounts).sort((a, b) => b[1] - a[1]);
---

<Layout
    title="Kumpulan Tag | Portal Online"
    description="Temukan semua artikel, tutorial, dan tips berdasarkan topik di Portal Online."
>
    <Navbar />

    <main class="page-content">
        <!-- Hero -->
        <section class="page-hero">
            <div class="container">
                <span class="badge">üè∑Ô∏è Eksplorasi Topik</span>
                <h1 class="page-title font-display">
                    Kumpulan <span class="text-gradient">Tag</span>
                </h1>
                <p class="page-subtitle">
                    {sortedTags.length} topik tersedia ‚Äî temukan artikel yang relevan
                    dengan minat Anda.
                </p>
            </div>
        </section>

        <!-- Tags -->
        <section class="section">
            <div class="container" style="max-width: 780px;">
                <div class="tags-cloud">
                    {
                        sortedTags.map(([tag, count]) => (
                            <a href={`/tags/${tag}`} class="tag-item">
                                <span class="tag-name">#{tag}</span>
                                <span class="tag-count">{count}</span>
                            </a>
                        ))
                    }
                </div>
            </div>
        </section>
    </main>

    <Footer />
</Layout>

<style>
    .page-content {
        padding-top: 6rem;
    }

    .page-hero {
        padding: 3.5rem 0 2rem;
        text-align: center;
        border-bottom: 1px solid var(--color-border);
    }

    .page-hero .badge {
        margin-bottom: 0.75rem;
    }

    .page-title {
        font-size: clamp(1.75rem, 5vw, 3rem);
        font-weight: 800;
        line-height: 1.2;
        margin-bottom: 1rem;
    }

    .page-subtitle {
        max-width: 520px;
        margin: 0 auto;
        color: var(--color-text-muted);
        font-size: 1rem;
        line-height: 1.7;
    }

    /* Tag cloud */
    .tags-cloud {
        display: flex;
        flex-wrap: wrap;
        gap: 0.625rem;
        padding: 0.5rem 0;
    }

    .tag-item {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 9999px;
        border: 1px solid var(--color-border);
        background: transparent;
        text-decoration: none;
        transition: all var(--transition-fast);
    }

    .tag-item:hover {
        border-color: rgba(var(--color-primary), 0.5);
        background: rgba(var(--color-primary), 0.07);
    }

    .tag-name {
        font-size: 0.9375rem;
        font-weight: 500;
        color: var(--color-text);
        transition: color var(--transition-fast);
    }

    .tag-item:hover .tag-name {
        color: rgb(var(--color-primary));
    }

    .tag-count {
        font-size: 0.75rem;
        font-weight: 600;
        padding: 0.1rem 0.45rem;
        border-radius: 9999px;
        background: rgba(255, 255, 255, 0.07);
        color: var(--color-text-subtle);
        min-width: 1.5rem;
        text-align: center;
    }

    .tag-item:hover .tag-count {
        background: rgba(var(--color-primary), 0.15);
        color: rgb(var(--color-primary));
    }
</style>
